@* RUTA: Views/Shared/_Layout.cshtml *@
@using System.Text.Json
@{
    var title = ViewData["Title"] as string ?? "Gracia Divina";
}
<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title</title>

    @* --- CSS (usa local de wwwroot/lib o cambia a CDN si no existe) --- *@
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @RenderSection("Styles", required: false)



    @* Favicon (opcional) *@
    <link rel="icon" type="image/png" href="~/img/favicon.png" />
</head>
<body class="d-flex flex-column min-vh-100">
    @* Header / Navbar *@
    @await Html.PartialAsync("_Header")

    <main class="container py-4 flex-grow-1">
        @RenderBody()
    </main>

    @* Footer y minicart *@
    @await Html.PartialAsync("_Footer")
    @await Html.PartialAsync("_MiniCart")

    @* --- JS (Bootstrap 5 bundle) --- *@
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    @* Scripts de la app *@
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script src="~/js/carrito-toast.js" asp-append-version="true"></script>
    @if (TempData["ToastMsg"] is string toastMsg)
    {
        var toastType = TempData["ToastType"] as string ?? "success";
        var toastImg = TempData["ToastImg"] as string ?? Url.Content("~/img/placeholder.svg");

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Llama a la función global del archivo carrito-toast.js
                mostrarToast(
                    @Html.Raw(JsonSerializer.Serialize(toastMsg)),
                    @Html.Raw(JsonSerializer.Serialize(toastType)),
                    @Html.Raw(JsonSerializer.Serialize(toastImg))
                );
            });
        </script>
    }
    @* Soporte para Browser Refresh solo en desarrollo (evita los warnings) *@
    <environment include="Development">
        <script src="/_framework/aspnetcore-browser-refresh.js"></script>
    </environment>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
